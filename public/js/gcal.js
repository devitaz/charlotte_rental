// gcal.js
// bitbucket.org/pgrippi/gcal.js
;(function(){"use strict";var e=null,f=!1;function h(a){this.q=a.replace(/\/public\/basic$/i,"/public/full").replace(/^http:/i,"https:")}function j(a,c,b,d){this.a=a;this.b=c;this.c=b;this.d=d;this.f=0===a&&0===c&&0===b&&0===d}function k(a){var c=a.gd$when||[];this.e=f;0<c.length?(this.i=l(c[0].startTime),this.h=l(c[0].endTime),this.e=/^\d{4}-\d{2}-\d{2}$/.test(c[0].startTime)):this.h=this.i=e;this.p=a.title.$t}function m(a){var c=a.cloneNode(f);a.parentNode.insertBefore(c,a);a.parentNode.removeChild(a);return c}
function r(a){return document.createTextNode(""+a)}function s(a,c){if(a!=e)if(a.length===+a.length)for(var b=0,d=a.length;b<d&&c.call(void 0,a[b],b,a)!==f;++b);else for(b in a)if(a.hasOwnProperty(b)&&c.call(void 0,a[b],b,a)===f)break}function t(a,c){s(u.call(arguments,1),function(c){for(var d in c)c.hasOwnProperty(d)&&a[d]==e&&(a[d]=c[d])});return a}function v(a){var c=u.call(arguments),b=c[0],d,i;i=1;for(d=c.length;i<d;++i)b=b.replace(RegExp("\\{"+(i-1)+"\\}","g"),c[i]);return b}
function w(a){a=(a-(new Date).getTime())/1E3;return 0>=a?j.o():new j(Math.floor(a/86400)%1E5,Math.floor(a/3600)%24,Math.floor(a/60)%60,Math.floor(a%60))}function y(a,c){return a!=e&&Object.prototype.toString.call(a)==="[object "+c+"]"}function z(a){return(10>a?"0":"")+a}function A(a){return[a.getUTCFullYear(),"-",z(a.getUTCMonth()+1),"-",z(a.getUTCDate()),"T",z(a.getUTCHours()),":",z(a.getUTCMinutes()),":",z(a.getUTCSeconds()),"Z"].join("")}
function l(a){var a=a.match(/([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?/),c=0,b=new Date(parseInt(a[1],10),0,1);a[3]&&b.setMonth(parseInt(a[3],10)-1);a[5]&&b.setDate(parseInt(a[5],10));a[7]&&b.setHours(parseInt(a[7],10));a[8]&&b.setMinutes(parseInt(a[8],10));a[10]&&b.setSeconds(parseInt(a[10],10));a[12]&&b.setMilliseconds(1E3*parseFloat("0."+a[12]));a[14]&&(c=60*parseInt(a[16],10)+parseInt(a[17],10),c*="-"===a[15]?1:
-1);c-=b.getTimezoneOffset();b.setTime(b.getTime()+6E4*c);return b}function B(a){var c=[];s(a.feed.entry||[],function(a){c.push(new k(a))});return c}function C(a,c){var b=(c||"").split(/\s+/),d;a&&1===a.nodeType&&(!a.className&&1===b.length?a.className=c:(d=" "+a.className+" ",s(b,function(a){0>d.indexOf(" "+a+" ")&&(d+=a+" ")}),a.className=D(d)))}
function E(a,c){var b=(c||"").split(/\s+/),d;a&&(1===a.nodeType&&a.className)&&(d=(" "+a.className+" ").replace(/[\t\r\n]/g," "),s(b,function(a){for(;0<=d.indexOf(" "+a+" ");)d=d.replace(" "+a+" "," ")}),a.className=c?D(d):"")}function T(a,c){var b=document.createElement("span");s(a||{},function(a,c){"className"===c?b.className=a:b.setAttribute(c,a)});s(c||[],function(a){b.appendChild(a)});return b}var u=Array.prototype.slice,U=String.prototype.trim,V={format:"text",separator:", ",showZeroDays:f};
h.prototype.g=function(a,c){c=t(c||{},V);c.format=c.format.toLowerCase();a=m(a);C(a,"gcaljs gcaljs-loading gcaljs-"+c.format);a.appendChild(r("Loading Calendar Event List..."));var b=new Date,d=this;b.setHours(0,0,0,0);this.k(b,function(b){var n,g=new Date,p,x;E(a,"gcaljs-loading");s(b,function(a){if(!a.n()&&(p=a.l(),x=a.j(),g>p&&g<x||g<p))return n=a,f});if(void 0===n)a.firstChild.textContent="No upcoming events.",C(a,"gcaljs-noevents");else{var F=n.m(),q,G,H,I,J,K,L,M,N,O,P,Q,R;"html"===c.format&&
(a=m(a),b=T({className:"gcaljs-event-title"}),b.appendChild(r(F)),q=T({className:"gcal-js-event-status"},[r("")]),G=T({className:"gcaljs-event-days"},[H=T({className:"gcal-js-num"},[r("")]),r(" "),I=T({className:"gcal-js-noun"},[r("")])]),J=T({className:"gcaljs-event-hours"},[K=T({className:"gcal-js-num"},[r("")]),r(" "),L=T({className:"gcal-js-noun"},[r("")])]),M=T({className:"gcaljs-event-minutes"},[N=T({className:"gcal-js-num"},[r("")]),r(" "),O=T({className:"gcal-js-noun"},[r("")])]),P=T({className:"gcaljs-event-seconds"},
[Q=T({className:"gcal-js-num"},[r("")]),r(" "),R=T({className:"gcal-js-noun"},[r("")])]),s([b,r(" "),q,r(" "),G,T({className:"gcal-js-separator"},[r(c.separator)]),J,T({className:"gcal-js-separator"},[r(c.separator)]),M,T({className:"gcal-js-separator"},[r(c.separator)]),P],function(c){a.appendChild(c)}));var S,b=function(){var b=w(p),g=f;b.f&&(b=w(x),g=!0);if(b.f)window.clearInterval(S),d.g(a,c);else{var i=(g?"ends":"starts")+" in";0===b.a?C(a,"gcaljs-zero-days"):E(a,"gcaljs-zero-days");"html"===
c.format?(g?(C(q,"gcaljs-event-inprogress"),E(q,"gcaljs-event-future")):(E(q,"gcaljs-event-inprogress"),C(q,"gcaljs-event-future")),q.firstChild.textContent=i,H.firstChild.textContent=b.a,I.firstChild.textContent="day"+(1===b.a?"":"s"),K.firstChild.textContent=b.b,L.firstChild.textContent="hour"+(1===b.b?"":"s"),N.firstChild.textContent=b.c,O.firstChild.textContent="minute"+(1===b.c?"":"s"),Q.firstChild.textContent=b.d,R.firstChild.textContent="second"+(1===b.d?"":"s")):a.firstChild.textContent=v("{0} {1} {2}{3} hour{4}{5}{6} minute{7}{8}{9} second{10}",
F,i,0<b.a||c.showZeroDays?v("{0} day{1}{2}",b.a,1===b.a?"":"s",c.separator):"",b.b,1===b.b?"":"s",c.separator,b.c,1===b.c?"":"s",c.separator,b.d,1===b.d?"":"s")}};S=window.setInterval(b,1E3);b()}});return this};
h.prototype.k=function(a,c,b){for(var d=[],i=0;8>i;++i)d.push(Math.floor(65536*Math.random()).toString(16));var n="gcaljs_"+d.join("");if(y(a,"Function"))b=a,c=a=e;else if(y(c,"Function"))b=c,c=e;else if(y(a,"Date"))if(y(c,"Date")){if(!y(b,"Function"))throw"invalid callback";}else throw"invalid maxStartTime";else throw"invalid minStartTime";var g,d={sortorder:"ascending",alt:"json-in-script","user-agent":"gcal.js",callback:n};a!=e&&(d["start-min"]=A(a));c!=e&&(d["start-max"]=A(c));window[n]=function(a){window[n]=
void 0;g.parentNode.removeChild(g);b.call(window,B(a))};g=document.createElement("script");g.type="text/javascript";var a=g,c=this.q+"?",p=[];s(d,function(a,b){p.push(encodeURIComponent(b)+"="+encodeURIComponent(a))});d=p.join("&").replace(/%20/g,"+");a.src=c+d;a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(g,a)};j.o=function(){return new j(0,0,0,0)};k.prototype.l=function(){return this.i};k.prototype.j=function(){return this.h};k.prototype.m=function(){return this.p||"(No title)"};
k.prototype.n=function(){return this.e};var D=U&&!U.call("\ufeff\u00a0")?function(a){return a==e?"":U.call(a)}:function(a){return a==e?"":(""+a).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};window.gcal=function(a){return new h(a)};h.prototype.getEvents=h.prototype.k;h.prototype.countdown=h.prototype.g;k.prototype.getStartTime=k.prototype.l;k.prototype.getEndTime=k.prototype.j;k.prototype.getTitle=k.prototype.m;k.prototype.isAllDay=k.prototype.n}());